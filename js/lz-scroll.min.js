/*!
 * lz-scroll v1.0.0
 * Copyright © lzmoop ( 磨盘兄弟 )
 * Author: Jack Zhang
 * Date: 2017
*/
;(function(d){d.extend({isObject:function(f){return Object.prototype.toString.call(f)==="[object Object]";}});var b=function(f){this.$ele=d(f);this.param=this.$ele.data("lzscroll-param");
this.status=this.$ele.data("lzscroll-status");this.containerX=this.$ele.data("lzscroll-containerX");this.containerY=this.$ele.data("lzscroll-containerY");
this.barX=this.$ele.data("lzscroll-barX");this.barY=this.$ele.data("lzscroll-barY");};b.prototype={setEvent:function(){var f=this;d.each(this.param.event,function(g,h){f[h]&&f[h]();
});},wheel:function(){var h=this.$ele,g=h.get(0).scrollMethods,j=this.param,f=this.status,i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(k){window.setTimeout(k,1000/60);
};h.on("mousewheel.lzscroll DOMMouseScroll.lzscroll",function(p){g._refresh();var n=j.axis==="x"?f.controlW:f.controlH,r=j.axis==="x"?h.scrollLeft():h.scrollTop(),q=j.axis==="x"?f.contentW:f.contentH,o=j.axis==="x"?f.boxW:f.boxH,t=r;
if(f.canWheel&&n){var s=(p.originalEvent.wheelDelta&&(p.originalEvent.wheelDelta>0?1:-1))||(p.originalEvent.detail&&(p.originalEvent.detail>0?-1:1));var k=j.animation?~~(j.speed/100*6):1,m=~~(j.distance/k),l=function(){k--;
if(s>0){r-=m;}else{if(s<0){r+=m;}}r=j.axis==="x"?g._doScrollX(r):g._doScrollY(r);if(k>0){i(l);}};l();if((t!==0||r!==0)&&(t!==q-o||r!==q-o)){return false;
}}});},display:function(){var j=this.$ele,h=this.status,k=this.param,f=this.containerY,g=this.containerX,i=null;j.off(".scrolldisplay");if(k.mode==="hover"){j.on("mouseenter.scrolldisplay",function(l){(!!f&&h.controlH&&!h.mouseY&&!h.mouseX)&&f.stop().hide().fadeIn(200);
(!!g&&h.controlW&&!h.mouseY&&!h.mouseX)&&g.stop().hide().fadeIn(200);}).on("mouseleave.scrolldisplay",function(l){(!!f&&!h.mouseY&&!h.mouseX)&&f.stop().fadeOut(200);
(!!g&&!h.mouseX&&!h.mouseY)&&g.stop().fadeOut(200);});}else{if(k.mode==="active"){j.on("scroll.scrolldisplay",function(l){(!!f&&h.controlH)&&f.show();(!!g&&h.controlW)&&g.show();
if(i){clearTimeout(i);i=null;}i=setTimeout(function(){!!f&&f.fadeOut(200);!!g&&g.fadeOut(200);},1000);});}}},drag:function(){var l=this.$ele,p=l.get(0).scrollMethods,j=this.status,h=this.param,k=this.containerX,i=this.containerY,n=d(document),m=0,f=0,o=0,g=0;
if(this.barX){this.barX.off("mousedown.lzscroll").on("mousedown.lzscroll",function(q){p._refresh();o=q.offsetX;j.canWheel=false;j.mouseX=true;return false;
}).off("click.lzscroll").on("click.lzscroll",function(q){return false;});}if(this.barY){this.barY.off("mousedown.lzscroll").on("mousedown.lzscroll",function(q){p._refresh();
m=q.offsetY;j.canWheel=false;j.mouseY=true;return false;}).off("click.lzscroll").on("click.lzscroll",function(q){return false;});}n.on("mouseup",function(q){q.preventDefault();
if(!j.mouseH&&(j.mouseY||j.mouseX)&&h.mode==="hover"){!!k&&k.hide();!!i&&i.hide();}j.mouseY=false;j.mouseX=false;j.canWheel=true;});l.off("mouseup.lzscroll").on("mouseup.lzscroll",function(q){j.mouseY=false;
j.mouseX=false;j.canWheel=true;});l.off("click.lzscroll").on("click.lzscroll",function(q){if(h.stopBubble){return false;}});n.on("mousemove",function(u){if(j.mouseY){var v=l.offset().top,r=u.clientY;
j.moveH=r-m-v;if(j.moveH<0){j.moveH=0;}else{if(j.moveH+j.controlH>j.boxH-j.space){j.moveH=j.boxH-j.controlH-j.space;}}q=~~(j.moveH*(j.contentH-j.boxH)/(j.boxH-j.space-j.controlH)+0.5);
p._doScrollY(q);}if(j.mouseX){var t=l.offset().left,s=u.clientX;j.moveW=s-o-t;if(j.moveW<0){j.moveW=0;}else{if(j.moveW+j.controlW>j.boxW-j.space){j.moveW=j.boxW-j.controlW-j.space;
}}var q=~~(j.moveW*(j.contentW-j.boxW)/(j.boxW-j.space-j.controlW)+0.5);p._doScrollX(q);}});},listenChange:function(){var h=this.$ele,g=h.get(0).scrollMethods,f=this.status;
if(!f.timer){f.timer=setInterval(function(){var i=h.data("lzscroll-stamp");i&&g._refresh();!i&&clearInterval(f.timer);},100);}}};var c=function(f){this.$ele=d(f);
this.param=this.$ele.data("lzscroll-param");this.status=this.$ele.data("lzscroll-status");this.containerX=this.$ele.data("lzscroll-containerX");this.containerY=this.$ele.data("lzscroll-containerY");
this.barX=this.$ele.data("lzscroll-barX");this.barY=this.$ele.data("lzscroll-barY");};c.prototype={_updateBox:function(){var n=this.$ele,i=this.status,j=this.containerX,g=this.containerY,m=false;
!!j&&j.css({bottom:0,left:0});!!g&&g.css({top:0,right:0});var o=n.innerWidth(),l=n.innerHeight(),p=n.prop("scrollWidth"),k=n.prop("scrollHeight"),f=n.scrollLeft(),q=n.scrollTop();
(i.boxH!=l)&&(i.boxH=l,m=true);(i.boxW!=o)&&(i.boxW=o,m=true);(i.contentW!=p)&&(i.contentW=p,m=true);(i.contentH!=k)&&(i.contentH=k,m=true);(!!g&&i.moveH>l-this.barY.height()-i.space)&&(m=true);
(!!j&&i.moveX>o-this.barX.width()-i.space)&&(m=true);!!j&&j.css({left:f,bottom:-q});!!g&&g.css({top:q,right:-f});return m;},_doScrollY:function(g){var i=this.$ele,j=this.param,h=this.status;
g=(g<0)?0:g;g=(g>(h.contentH-h.boxH))?h.contentH-h.boxH:g;var f=~~(g*(h.boxH-h.space-h.controlH)/(h.contentH-h.boxH)+0.5);h.moveH=f;if(this.containerY){this.containerY.css("top",g);
this.barY.css("top",f);}if(this.containerX){this.containerX.css("bottom",-g);}h.scrollH=g;j._onUpdate&&j._onUpdate();i.scrollTop(g);return g;},_doScrollX:function(f){var h=this.$ele,j=this.param,g=this.status;
f=(f<0)?0:f;f=(f>(g.contentW-g.boxW))?g.contentW-g.boxW:f;var i=~~(f*(g.boxW-g.space-g.controlW)/(g.contentW-g.boxW)+0.5);g.moveW=i;if(this.containerX){this.containerX.css("left",f);
this.barX.css("left",i);}if(this.containerY){this.containerY.css("right",-f);}g.scrollW=f;j._onUpdate&&j._onUpdate();h.scrollLeft(f);return f;},_updateStyleY:function(){var k=this.$ele,i=this.status,m=this.param,f=this.containerY,h=i.boxH,j=i.contentH,l=i.space,g=j<=h?0:h/j*(h-l)>6?~~(h/j*(h-l)+0.5):6;
m.barChange===true?(i.controlH=g):(i.controlH=this.barY.height());f.css("height",h-l);if(!g){f.css("display","none");}else{(m.mode=="always"||(m.mode=="hover"&&i.mouseH))&&f.css("display","block");
m.barChange&&this.barY.css("height",g);}},_updateStyleX:function(){var i=this.$ele,h=this.status,m=this.param,g=this.containerX,l=h.boxW,f=h.contentW,j=h.space,k=f<=l?0:l/f*(l-j)>6?~~(l/f*(l-j)+0.5):6;
m.barChange===true?(h.controlW=k):(h.controlW=this.barX.width());g.css("width",l-j);if(!k){g.css("display","none");}else{(m.mode=="always"||(m.mode=="hover"&&h.mouseH))&&g.css("display","block");
m.barChange&&this.barX.css("width",k);}},_refresh:function(){var f=this.$ele,g=this._updateBox();(!!this.containerX&&g)&&(this._doScrollX(f.scrollLeft()),this._updateStyleX());
(!!this.containerY&&g)&&(this._doScrollY(f.scrollTop()),this._updateStyleY());}};var e=function(h,g,f,i){this.$ele=d(h);this.$ele.data("lzscroll-param",this._initParam(g,f,i));
this.$ele.data("lzscroll-stamp",1);this.$ele.data("lzscroll-status",{canWheel:true,axis:[],mouseX:false,mouseY:false,mouseH:false,contentH:0,contentW:0,boxH:0,boxW:0,controlH:0,controlW:0,moveH:0,moveW:0,scrollH:0,scrollW:0,space:0,timer:null});
};e.prototype={defaults:{axis:"y",theme:"default",distance:120,speed:200,animation:true,barChange:true,mode:"always",containerWidth:8,barWidth:6,listenChange:true,stopBubble:false,_onScroll:null,_onUpdate:null,event:["wheel","drag"]},_initParam:function(g,f,j){var i=this.defaults,h=null;
if(d.isObject(g)){i=d.extend({},i,g);}else{i.axis=g;i.distance=f;i.mode=j;}!isNaN(g)&&(i.speed=g);if((h=this.$ele.data("lzscroll-param"))){i=d.extend({},i,h);
}i.axis=(i.axis=="x"||i.axis=="y"||i.axis=="xy"||i.axis=="yx")?i.axis:"y";i.mode=(i.mode=="active"||i.mode=="hover"||i.mode=="always")?i.mode:"always";
isNaN(i.distance)&&(i.distance=120);isNaN(i.speed)&&(i.speed=200);isNaN(i.containerWidth)&&(i.containerWidth=8);isNaN(i.BarWidth)&&(i.BarWidth=6);i.listenChange=i.listenChange===false?false:true;
i.animation=i.animation===false?false:true;i.barChange=i.barChange===false?false:true;!i.theme&&(i.theme="default");return i;},_layout:function(){var k=this.$ele,m=k.data("lzscroll-param"),i=k.data("lzscroll-status");
k.css("position")==="static"&&k.css("position","relative");k.css("overflow")!=="hidden"&&k.css("overflow","hidden");i.axis=m.axis.split("");(i.axis.length===2)&&(i.space=m.containerWidth);
var h="lzscroll-"+m.theme,f=d("<div class='"+h+"-containerY'></div>").css({width:m.containerWidth,top:0,right:0,position:"absolute"}),g=d("<div class='"+h+"-containerX'></div>").css({height:m.containerWidth,left:0,bottom:0,position:"absolute"}),j=d("<div class='"+h+"-barY'></div>").css({width:m.barWidth,left:(m.containerWidth-m.barWidth)/2,top:0,position:"absolute"}),l=d("<div class='"+h+"-barX'></div>").css({height:m.barWidth,top:(m.containerWidth-m.barWidth)/2,left:0,position:"absolute"});
if(d.inArray("x",i.axis)>=0){g.append(l).appendTo(k);k.data("lzscroll-containerX",g);k.data("lzscroll-barX",l);}if(d.inArray("y",i.axis)>=0){f.append(j).appendTo(k);
k.data("lzscroll-containerY",f);k.data("lzscroll-barY",j);}},_initEvent:function(){var k=this.$ele,i=k.get(0).scrollMethods,l=k.data("lzscroll-param"),h=k.data("lzscroll-status"),f=k.data("lzscroll-containerY"),g=k.data("lzscroll-containerX"),j=new b(k);
if(l.mode!=="always"){l.event.push("display");!!f&&f.css("display","none");!!g&&g.css("display","none");}d(window).resize(function(){if(!!k.data("lzscroll-stamp")){i._refresh();
}});k.off(".lzscroll").on("mouseenter.lzscroll",function(){h.mouseH=true;}).on("mouseleave.lzscroll",function(){h.mouseH=false;}).on("scroll.lzscroll",function(){l._onScroll&&l._onScroll();
});l.listenChange&&(l.event.push("listenChange"));j.setEvent();i._refresh();},_init:function(){var f=this.$ele.get(0);this._layout();f.scrollMethods=new c(f);
this._initEvent();}};var a=function(f){this.$ele=d(f);};a.prototype={destory:function(){d.each(this.$ele,function(j,k){var i=d(k);i.scrollTop(0);i.scrollLeft(0);
var h=i.data("lzscroll-containerX"),f=i.data("lzscroll-containerY"),g=i.data("lzscroll-status");g.timer&&clearInterval(g.timer);!!h&&h.remove();!!f&&f.remove();
i.off(".lzscroll").off(".scrolldisplay");i.removeData("lzscroll-param").removeData("lzscroll-status").removeData("lzscroll-stamp");k.scrollMethods=null;
});return false;},init:function(g,f,h){this.destroy();this.$ele.lzscroll(g,f,h);},refresh:function(){d.each(this.$ele,function(f,g){g.scrollMethods._refresh();
});return this;},scrollLeft:function(f){var g=this.$ele;if(f===undefined){return g.eq(0).data("lzscroll-status").scrollW;}else{g.get(0).scrollMethods._doScrollX(f);
}return this;},scrollTop:function(f){var g=this.$ele;if(f===undefined){return g.eq(0).data("lzscroll-status").scrollH;}else{g.get(0).scrollMethods._doScrollY(f);
}return this;},on:function(h,f){var g=this.$ele;f=d.proxy(f,this);if(h==="scroll"){d.each(g,function(i,j){if(typeof f==="function"){d(j).data("lzscroll-param")._onScroll=f;
}});}else{if(h==="update"){d.each(g,function(i,j){if(typeof f==="function"){d(j).data("lzscroll-param")._onUpdate=f;}});}}}};d.fn.scrollTool=function(){return new a(this);
};d.fn.lzscroll=function(g,f,h){d.each(this,function(i,j){if(!d(j).data("lzscroll-stamp")){new e(j,g,f,h)._init();}});return this.scrollTool();};})(jQuery);
